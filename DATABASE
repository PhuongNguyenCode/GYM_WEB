-- 1. PHÒNG TẬP (tạo trước vì nhiều bảng khác phụ thuộc)
CREATE TABLE PHONGTAP (
    MaPhongTap INT PRIMARY KEY IDENTITY(1,1),
    TenPhong NVARCHAR(100) NOT NULL,
    DiaChi NVARCHAR(200) NOT NULL,
	ImagePTap NVARCHAR(MAX),
    GioMoCua TIME,
    GioDongCua TIME,
    GhiChu NVARCHAR(255)
);

-- 2. ADMIN
CREATE TABLE ADMIN (
    MaAdmin INT PRIMARY KEY IDENTITY(1,1),
    HoTen NVARCHAR(100) NOT NULL,
    TenDangNhap VARCHAR(50) UNIQUE NOT NULL,
    MatKhau VARCHAR(255) NOT NULL,
    QuyenHan NVARCHAR(50) DEFAULT N'Admin', -- Admin / SuperAdmin
    TrangThai NVARCHAR(20) DEFAULT N'Hoạt động'
);

-- 3. LOẠI GÓI TẬP
CREATE TABLE LOAIGOITAP (
    MaLoaiGoi INT PRIMARY KEY,
    TenLoaiGoi NVARCHAR(100) NOT NULL
);

-- 4. THÀNH VIÊN
CREATE TABLE THANHVIEN (
    MaThanhVien INT PRIMARY KEY IDENTITY(1,1),
    HoTen NVARCHAR(100) NOT NULL,
    SDT NVARCHAR(15),
    Email NVARCHAR(100),
	MatKhau NVARCHAR(100),
    NgayDangKy DATE DEFAULT GETDATE(),
    TrangThai NVARCHAR(20) DEFAULT N'Đang hoạt động',
    MaPhongTap INT,
    FOREIGN KEY (MaPhongTap) REFERENCES PHONGTAP(MaPhongTap)
);

-- 5. GÓI TẬP
CREATE TABLE GOITAP (
    MaGoiTap INT PRIMARY KEY IDENTITY(1,1),
    TenGoiTap NVARCHAR(100) NOT NULL,
    ImageGoi NVARCHAR(MAX) NOT NULL,
    MoTa NVARCHAR(255),
    MaLoaiGoi INT,
    GiaTien DECIMAL(10,2),
    FOREIGN KEY (MaLoaiGoi) REFERENCES LOAIGOITAP(MaLoaiGoi)
);

-- 6. ĐĂNG KÝ GÓI TẬP
CREATE TABLE DANGKYGOI (
    MaDangKy INT PRIMARY KEY IDENTITY(1,1),
    MaThanhVien INT NOT NULL,
    MaGoiTap INT NOT NULL,
    TrangThai NVARCHAR(20),
    FOREIGN KEY (MaThanhVien) REFERENCES THANHVIEN(MaThanhVien),
    FOREIGN KEY (MaGoiTap) REFERENCES GOITAP(MaGoiTap)
);

-- 7. CHI TIẾT ĐĂNG KÝ GÓI
CREATE TABLE CT_DANGKYGOI (
    MaChiTiet INT PRIMARY KEY IDENTITY(1,1),
    MaDangKy INT,
    NgayBatDau DATE NOT NULL,
    NgayKetThuc DATE,
    SoBuoi INT,
    DonGia DECIMAL(10,2),
    FOREIGN KEY (MaDangKy) REFERENCES DANGKYGOI(MaDangKy)
);

-- 8. THANH TOÁN
CREATE TABLE THANHTOAN (
    MaThanhToan INT PRIMARY KEY IDENTITY(1,1),
    MaDangKy INT NOT NULL,
    NgayThanhToan DATE DEFAULT GETDATE(),
    SoTien DECIMAL(10,2) NOT NULL,
    PhuongThuc NVARCHAR(50),
    GhiChu NVARCHAR(255),
    FOREIGN KEY (MaDangKy) REFERENCES DANGKYGOI(MaDangKy)
);

-- 9. NHÂN VIÊN
CREATE TABLE NHANVIEN (
    MaNhanVien INT PRIMARY KEY IDENTITY(1,1),
    HoTen NVARCHAR(100) NOT NULL,
    SDT NVARCHAR(15),
    Email NVARCHAR(100),
    ChucVu NVARCHAR(50),
    TrangThai NVARCHAR(20) DEFAULT N'Đang làm việc',
    MaPhongTap INT,
    FOREIGN KEY (MaPhongTap) REFERENCES PHONGTAP(MaPhongTap)
);

-- 10. LỊCH TẬP
CREATE TABLE LICHTAP (
    MaLichTap INT PRIMARY KEY IDENTITY(1,1),
    MaHLV INT NOT NULL,
    NgayTap DATE NOT NULL,
    GioBatDau TIME,
    GioKetThuc TIME,
    NoiDung NVARCHAR(255),
    FOREIGN KEY (MaHLV) REFERENCES NHANVIEN(MaNhanVien)
);
CREATE TABLE CHONDICHVU (
    MaDichVu INT PRIMARY KEY IDENTITY(1,1),
    MaDangKy INT NULL,
    LoaiDichVu NVARCHAR(50) NOT NULL,
    CoSo NVARCHAR(100) NOT NULL,
    Email VARCHAR(50) NOT NULL,
    SDT VARCHAR(15) NOT NULL,
    HoTen NVARCHAR(100) NOT NULL,
    NgayChon DATE DEFAULT GETDATE(),
    TrangThai NVARCHAR(20) DEFAULT N'Hoạt động'
    CONSTRAINT FK_DichVu_DangKyGoi FOREIGN KEY (MaDangKy) REFERENCES DANGKYGOI(MaDangKy)
);
CREATE TABLE DK_THANHVIEN (
    MaDKTV INT PRIMARY KEY IDENTITY(1,1),
    HoTen NVARCHAR(100) NOT NULL,
    SDT NVARCHAR(15),
    Email NVARCHAR(100),
    NgaySinh DATE,
    GioiTinh NVARCHAR(10),
    MaGoiTap INT NOT NULL,
    NgayBatDau DATE NOT NULL,
    NgayKetThuc DATE,
    SoBuoi INT,
    DonGia DECIMAL(10,2),
    ThanhToan NVARCHAR(50),
    FOREIGN KEY (MaGoiTap) REFERENCES GOITAP(MaGoiTap)
);

